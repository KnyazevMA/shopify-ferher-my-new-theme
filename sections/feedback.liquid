{% comment %}
  Contact form section (meets a11y + honeypot + translations)
{% endcomment %}

<section class="feedback" role="region" aria-labelledby="ContactForm-Title-{{ section.id }}">
  <div class="page-width">
    {% if section.settings.title != blank %}
      <h2 id="ContactForm-Title-{{ section.id }}" class="feedback__title">
        {{ section.settings.title | escape }}
      </h2>
    {% endif %}

    {% if section.settings.text != blank %}
      <div class="feedback__intro">{{ section.settings.text }}</div>
    {% endif %}

    {%- form 'contact', id: 'ContactForm', class: 'feedback__form', novalidate: true -%}
      {% if form.posted_successfully? %}
        <p class="feedback__success" role="status" aria-live="polite">
          {{ 'sections.contact.success' | t: default: 'Thank you! Your message has been sent.' }}
        </p>
      {% endif %}

      {% if form.errors %}
        <div class="feedback__errors" role="alert" aria-live="assertive">
          {{ form.errors | default_errors }}
        </div>
      {% endif %}

      <div class="feedback__wrapper">
        {%- assign name_error = form.errors.translated_fields.name | default: blank -%}
        <label class="feedback__field" for="ContactForm-Name-{{ section.id }}">
          <span class="feedback__label">{{ 'sections.contact.name_label' | t: default: 'Name' }}</span>
          <input
            id="ContactForm-Name-{{ section.id }}"
            class="feedback__input"
            type="text"
            name="contact[name]"
            autocomplete="name"
            placeholder="{{ 'sections.contact.name_placeholder' | t: default: 'Enter your name' }}"
            {% if name_error %}
              aria-invalid="true" aria-describedby="ContactForm-NameError-{{ section.id }}"
            {% endif %}
            value="{{ form.name | default: customer.name | escape }}"
          >
          {% if name_error %}
            <p id="ContactForm-NameError-{{ section.id }}" class="feedback__error">
              {{ name_error | capitalize }}
              {{ form.errors.messages.name }}
            </p>
          {% endif %}
        </label>

        {%- assign phone_error = form.errors.translated_fields.phone | default: blank -%}
        {% if section.settings.show_phone %}
          <label class="feedback__field" for="ContactForm-Phone-{{ section.id }}">
            <span class="feedback__label">{{ 'sections.contact.phone_label' | t: default: 'Phone' }}</span>
            <input
              id="ContactForm-Phone-{{ section.id }}"
              class="feedback__input"
              type="tel"
              name="contact[phone]"
              autocomplete="tel"
              placeholder="{{ 'sections.contact.phone_placeholder' | t: default: 'Enter phone number' }}"
              pattern="\+?[0-9\-() ]*"
              {% if phone_error %}
                aria-invalid="true" aria-describedby="ContactForm-PhoneError-{{ section.id }}"
              {% endif %}
              value="{{ form.phone | escape }}"
            >
            {% if phone_error %}
              <p id="ContactForm-PhoneError-{{ section.id }}" class="feedback__error">
                {{ phone_error | capitalize }}
                {{ form.errors.messages.phone }}
              </p>
            {% endif %}
          </label>
        {% endif %}

        {%- assign email_error = form.errors.translated_fields.email | default: blank -%}
        <label class="feedback__field feedback__field--flat" for="ContactForm-Email-{{ section.id }}">
          <span class="feedback__label">{{ 'sections.contact.email_label' | t: default: 'Email' }}</span>
          <input
            id="ContactForm-Email-{{ section.id }}"
            class="feedback__input"
            type="email"
            name="contact[email]"
            autocomplete="email"
            placeholder="{{ 'sections.contact.email_placeholder' | t: default: 'Enter email' }}"
            required
            {% if email_error %}
              aria-invalid="true" aria-describedby="ContactForm-EmailError-{{ section.id }}"
            {% endif %}
            value="{{ form.email | default: customer.email | escape }}"
          >
          {% if email_error %}
            <p id="ContactForm-EmailError-{{ section.id }}" class="feedback__error">
              {{ email_error | capitalize }}
              {{ form.errors.messages.email }}
            </p>
          {% endif %}
        </label>

        {%- assign body_error = form.errors.translated_fields.body | default: blank -%}
        <label class="feedback__field feedback__field--flat" for="ContactForm-Message-{{ section.id }}">
          <span class="feedback__label">{{ 'sections.contact.message_label' | t: default: 'Message' }}</span>
          <textarea
            id="ContactForm-Message-{{ section.id }}"
            class="feedback__textarea"
            name="contact[body]"
            rows="5"
            placeholder="{{ 'sections.contact.message_placeholder' | t: default: 'Enter your message' }}"
            required
            {% if body_error %}
              aria-invalid="true" aria-describedby="ContactForm-BodyError-{{ section.id }}"
            {% endif %}
          >{{ form.body | escape }}</textarea>
          {% if body_error %}
            <p id="ContactForm-BodyError-{{ section.id }}" class="feedback__error">
              {{ body_error | capitalize }}
              {{ form.errors.messages.body }}
            </p>
          {% endif %}
        </label>

        {%- comment -%}
          Honeypot: приховане поле, яке не повинно заповнюватися людиною.
          Якщо воно заповнене — JS не дасть відправити форму.
        {%- endcomment -%}
        <div class="visually-hidden" aria-hidden="true">
          <label for="ContactForm-HP-{{ section.id }}">
            {{ 'forms.honeypot' | t: default: 'Leave this field empty' }}
          </label>
          <input
            id="ContactForm-HP-{{ section.id }}"
            type="text"
            name="hp"
            tabindex="-1"
            autocomplete="off"
          >
        </div>
      </div>

      <button
        class="btn feedback__btn"
        type="submit"
        aria-label="{{ 'sections.contact.submit_aria' | t: default: 'Send contact form' }}"
        data-contact-submit
      >
        {{ 'sections.contact.submit' | t: default: 'Submit' }}
      </button>
    {%- endform -%}
  </div>
</section>

{% schema %}
{
  "name": "Contact form",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Need help?"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Intro text",
      "default": "<p>Ask us anything. We\u2019ll get back to you soon.</p>"
    },
    {
      "type": "checkbox",
      "id": "show_phone",
      "label": "Show phone field",
      "default": true
    }
  ],
  "presets": [{ "name": "Contact form" }]
}
{% endschema %}
